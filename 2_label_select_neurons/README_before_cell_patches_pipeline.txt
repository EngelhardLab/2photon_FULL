

# Making cell & annulus patches


#### folder path used in this example :         D:\DBMC_bruker\m9399\24022025_patches




1. Check if all patches we successfully run:

	> Check the number of '*.roi' files in the 'patches_folder'  
		<ex> D:\DBMC_bruker\m9399\24022025_patches\patches_folder contains 15 '*.roi' files

	> Open the ds5_files folder and verify it contains the same amount of files
		<ex> :  D:\DBMC_bruker\m9399\24022025_patches\ds5_files 
			contains 15 'mc_image_stack_full_patch_*_ds5.tif' files

	> If any of them is missing, check which patch it is and run it using the DBMC.m script as previously done.


2. Open ImageJ.

	> Some useful macros : 
		*  crop AVG 500 stac.ijm
		*  Z_project.ijm
		*  makeband.ijm


3. Open 'template_mov.tif' to ImageJ and take a picture where you can see all neurons. You will use this as a guide 
   to mark neurons and take them just once. Call it 'patches&neurons_<date>'


4. Starting from patch one, drag the correspondent {AVG_500, ds5} files. For example, for patch one :

	* from D:\DBMC_bruker\m9399\24022025_patches drag to ImageJ the file ' mc_image_stack_full_patch_1_AVG_500.tif '
	* from D:\DBMC_bruker\m9399\24022025_patches\ds5_files drag to ImageJ the file ' mc_image_stack_full_patch_1_part1_ds5 ' 


5. Select the AVG_500 image and then run the macros called crop AVG 500 stac.ijm


6. Select the ds5 movie and run the macros called Z_project.ijm


7. With 'Freehand selections' enabled on the ImageJ bar start surrounding a cell. Add it to the ROI Manager 
   using 'T' on the keyboard. Do this for all visible neurons.

	> If in this patch you can observe a neuron that is also included in another patch, verify which patch it 
	  is convenient to take it from. Remember that any cell have to be taken just once.


8. Once you finish selecting all cells, in the ROI Manager go to More>Sort to reorganize the list of ROIs 


9. Again in the ROI Manager do More>Save to save all ROIs with the name according to the patch, for example : ROI_patch_2.zip

	> if there is only one cell in the patch please add 'ROI_patch_*' before the ROI name generated by ImageJ
	> For example, if there is only one cell in patch 12, and the name in the ROI Manager is : 0058-0057.roi
	  add 'ROI_patch_12_' at the beginning, so the cell roi should be called :  '  ROI_patch_12_0058-0057.roi '


10. After all cells in the patch are labeled and saved. Select the first one in the ROI Manager and run the macros
    called makeband.ijm
	> This should make a ring region around the cell from which you will have to select the neuropil of the cell


11. Go to the ImageJ menu bar and make a Right Click in 'Oval selection' and select 'Selection Brush Tool'


12. On the selected ROI (that now is the region around the cell) do Click+Shift to expand the region or Click+Alt to erase parts
    of it. When you are done, click 'Update' on the ROI Manager.
	>  Do this for all cells in the patch


13. Once you finish selecting all cells, again in the ROI Manager do More>Save to save all ROIs with the name according to the patch, for example : ROI_patch_2.zip

	> if there is only one cell in the patch please add 'ROI_patch_*' before the ROI name generated by ImageJ
	> For example, if there is only one cell in patch 12, and the name in the ROI Manager is : 0058-0057.roi
	  add 'ROI_patch_12_' at the beginning, so the cell roi should be called :  '  ROI_patch_12_0058-0057.roi '


k. Repeat from Step 4. until all visible neurons in patches 'patches&neurons.png' are marked



